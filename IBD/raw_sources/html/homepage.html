<div class="container">
	<div class="row">
		<div class="col-md-12">
			<h1>
				1000IBD
			</h1>
			<p id="description">
				Here you can find the patient characteristics of the 1000IBD dataset and subsets for which -omics data is available
			</p>
			<hr/>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6">
			<select id="dataset-select" style="width:100%">
				<option value="all_patients" selected="selected">All patients</option>
				<option value="ichip_patients">Patients with iChip samples</option>
				<option value="stool_patients">Patients with microbiome profiles from stool samples</option>
				<option value="biopsies_patients">Patients with microbiome profiles from biopsies</option>
			</select>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<h2 id="title"></h2>
		</div>
	</div>
	<div class="row">
		<div id="overview" class="col-md-12">
			<div class="row" id="counts">
				<div class="col-md-3">
					<ul class="list-group">
					  <li class="list-group-item count-info">
						<span class="badge" id="percentage-of-patients"></span>
						<span class="badge badge-primary" id="number-of-patients"></span>
						<b>Patients</b>
					  </li>
					   <li class="list-group-item count-info">
						<span class="badge" id="percentage-of-males"></span>
						<span class="badge badge-primary" id="number-of-males"></span>
						Male
					  </li>
					   <li class="list-group-item count-info">
						<span class="badge" id="percentage-of-females"></span>
						<span class="badge badge-primary" id="number-of-females"></span>
						Female
					  </li>
					  <li class="list-group-item count-info">
					  	<span class="badge" id="percentage-of-samples"></span>
						<span class="badge badge-primary" id="number-of-samples"></span>
						<b>Samples</b>
					  </li>
					  <li class="list-group-item count-info">
						<b>Age</b> <small>average (SD)</small>
						<span class="pull-right"><span id="age-mean"></span> (<span id="age-sd"></span>)</span>
					  </li>
					</ul>
				</div>
				<div class="col-md-9">
					<div class="panel panel-primary">
						<div class="panel-heading">Diagnosis</div>
						<div class="panel-body diagnosis-panel">
							<table class="table table-striped" id="diagnosis-table">
								<thead>
									<tr>
										<th>Count</th>
										<th>Percentage</th>
										<th>Diagnosis</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td id="count-cd"></td>
										<td id="percentage-cd"></td>
										<td>CD</td>
									</tr>
									<tr>
										<td id="count-uc"></td>
										<td id="percentage-uc"></td>	
										<td>UC</td>
									</tr>
									<tr>
										<td id="count-ibdu"></td>
										<td id="percentage-ibdu"></td>
										<td>IBDU</td>
									</tr>
									<tr>
										<td id="count-ibdi"></td>
										<td id="percentage-ibdi"></td>
										<td>IBDI</td>
									</tr>
							
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<canvas id="ibd-canvas" width="1140" height="500"></canvas>
		</div>
	</div>
</div>
<style>
	.badge-primary{ 
		background-color: #337ab7;
	}
	.count-info{
		padding: 0.75em!important;
	}
	#diagnosis-table{
		margin-bottom: 0px!important;
	}
	#diagnosis-table td{
		padding: 4.9px!important;
	}
	.diagnosis-panel {
		padding: 7px!important;
	}
	#title {
		margin-bottom: 1em;
	}
</style>
<script>
	function setTitle(data){
		$('#title').text(data.text);
	}
	
	function createImageString(numberOfPatients, numberOfPatientsWithLocation, percentage){
		return '('+numberOfPatientsWithLocation+' of '+numberOfPatients+' patients ('+percentage+'%))'
	}
	
	function addTextToImage(context, title, content, xPos, yPos, align) {
		context.textAlign=align
        context.fillText(title, xPos, yPos);
        context.fillText(content, xPos, yPos+20);
	}
	function drawImage(data){
		var canvas = document.getElementById("ibd-canvas");
     	var context = canvas.getContext("2d");
     	var imageObj = new Image();
     	var L1Number = data.L1Number;
     	var L1Percentage = data.L1Percentage;
     	var L2Number = data.L2Number;
     	var L2Percentage = data.L2Percentage;
     	var L3Number = data.L3Number;
     	var L3Percentage = data.L3Percentage;
     	var L4Number = data.L4Number;
     	var L4Percentage = data.L4Percentage;
     	var E1Number = data.E1Number;
     	var E1Percentage = data.E1Percentage;
     	var E2Number = data.E2Number;
     	var E2Percentage = data.E2Percentage;
     	var E3Number = data.E3Number;
     	var E3Percentage = data.E3Percentage;
     	var total = data.numberPatients;
    	imageObj.onload = function(){
         	context.drawImage(imageObj, 10, 10);
         	context.font = "12pt Calibri";
         	L1Text = createImageString(total, L1Number, L1Percentage);
         	L2Text = createImageString(total, L2Number, L2Percentage);
         	L3Text = createImageString(total, L3Number, L3Percentage);
         	L4Text = createImageString(total, L4Number, L4Percentage);
         	E1Text = createImageString(total, E1Number, E1Percentage);
         	E2Text = createImageString(total, E2Number, E2Percentage);
         	E3Text = createImageString(total, E3Number, E3Percentage);
         	addTextToImage(context, "Colonic disease (L2)", L2Text, 240, 290, "end");
         	addTextToImage(context, "Iliocolonic (L3)", L3Text, 240, 350, "end");
			addTextToImage(context, "UpperGI disease (L4)", L4Text, 410, 180, "start");
			addTextToImage(context, "Ileal disease (L1)", L1Text, 410, 320, "start");
			addTextToImage(context, "Extensive colitis (E3)", E3Text, 780, 340, "end");
			addTextToImage(context, "Left sided colitis (E2)", E2Text, 955, 320, "start");
			addTextToImage(context, "Proctitis (E1)", E1Text, 955, 390, "start");
     	};
     	imageObj.src = "/img/blankImg.png"; 
	}
	
	$(function () {
		$('#dataset-select').select2();
		var selected_option = $('#dataset-select').select2('data').id;
		setTitle($('#dataset-select').select2('data'));
		
		$('#dataset-select').on('change', function(e) {
			selected_option = $('#dataset-select').select2('data').id;
			setTitle($('#dataset-select').select2('data'));
		})
		molgenis.RestClient.prototype.getAsync('/api/v2/IBD_counts/'+selected_option, {}, function(counts){
			$('#number-of-patients').text(counts.numberPatients);
			$('#number-of-males').text(counts.countMale);
			$('#number-of-females').text(counts.countFemale);
			
			$('#percentage-of-patients').text('100%');
			$('#percentage-of-males').text(counts.percentageMale+'%');
			$('#percentage-of-females').text(counts.percentageFemale+'%');
			
			$('#percentage-cd').text(counts.percentageCD+'%');
			$('#percentage-uc').text(counts.percentageUC+'%');
			$('#percentage-ibdu').text(counts.percentageIBDU+'%');
			$('#percentage-ibdi').text(counts.percentageIBDI+'%');
			
			$('#count-cd').text(counts.totalCD);
			$('#count-uc').text(counts.totalUC);
			$('#count-ibdu').text(counts.totalIBDU);
			$('#count-ibdi').text(counts.totalIBDI);
			
			$('#age-mean').text(counts.meanAge);
			$('#age-sd').text(counts.sdAge);
			drawImage(counts);
		})
		
	});
</script>